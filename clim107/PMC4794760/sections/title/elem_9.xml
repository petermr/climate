<?xml version="1.0" encoding="UTF-8"?>
<sec disp-level="2" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Thermal niche changes</div>
 <sec disp-level="3" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Taxon sampling, sequencing</div>
  <p xmlns="http://www.w3.org/1999/xhtml">We used molecular data from previous studies
   <a ref-type="bibr" rid="b40" href="#b40">40</a>
   <a ref-type="bibr" rid="b44" href="#b44">44</a>
   <a ref-type="bibr" rid="b45" href="#b45">45</a>, completed with 51 new specimens of 27 additional taxa as well as specimens from different caves for the species with the widest distributions. The final matrix for the phylogenetic analyses included a total of 122 specimens of 64 species in 18 genera (out of the 85 known
   <a ref-type="bibr" rid="b40" href="#b40">40</a>
   <a ref-type="bibr" rid="b41" href="#b41">41</a>; see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Table S2</a>).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Specimens were collected by direct search or with the use of baits and stored in absolute ethanol. DNA extractions of single specimens were non-destructive, using either a phenol–chloroform method or commercial kits (mostly DNeasy Tissue Kit, Quiagen, Hilden, Germany) following the manufacturer’s instructions. Vouchers are kept at the Museo Nacional de Ciencias Naturales, Madrid (MNCN) and the Institute of Evolutionary Biology, Barcelona (IBE). We amplified and sequenced the same fragments as in a previous study
   <a ref-type="bibr" rid="b40" href="#b40">40</a>, i.e. seven genes totalling more than 4 Kb: five mitochondrial (cox1 –amplified in two fragments–, cob, rrnL, trnL, nad1 –the last three amplified in a continuous single fragment) and two nuclear (SSU, LSU). Primers and PCR conditions were the same as in a previous study
   <a ref-type="bibr" rid="b44" href="#b44">44</a>. New sequences (129) have been deposited in GenBank (EMBL) with Acc. Nos. LN849257-LN849385 (
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Table S2</a>).
  </p>
 </sec>
 <sec disp-level="3" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Phylogenetic analyses</div>
  <p xmlns="http://www.w3.org/1999/xhtml">We aligned length variable (i.e. ribosomal) sequences with MAFFT v. 7 and the Q-INS-i algorithm, which considers the secondary structure
   <a ref-type="bibr" rid="b45" href="#b45">45</a>. To obtain an ultrametric tree we used BEAST v.1.7
   <a ref-type="bibr" rid="b46" href="#b46">46</a> with an uncorrelated lognormal clock and a Yule speciation process. We linked the evolutionary rates of the mitochondrial protein coding genes and the two nuclear ribosomal genes respectively to reduce the number of free parameters, and used a GTR + I + G model with unlinked parameters for each partition. Trees were rooted in the node separating a clade with 1 instar larval development from a clade with either 2- or 1-instar, according to the topology of a previous study
   <a ref-type="bibr" rid="b39" href="#b39">39</a> (
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Fig. S2</a>). For the calibration we used the estimates obtained in this same study, that were based on the tectonic separation of the Sardinian plate, 16.6 Ma for the clade of species with a 1-instar cycle and 13.7 Ma for the clade of uncertain life cycle type. Both were set up as priors with a normal distribution with the estimated age as mean and a standard deviation of 1 MY.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">For the estimation of the minimum accumulated change in temperature experienced through the evolutionary history of the lineage, we used ancestral trait reconstruction in BEAST, using as a quantitative trait the temperature of the cave in which each specimen was found (either directly measured or inferred from the annual average temperature of the locality; see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Tables S2</a> and 
   <a ref-type="supplementary-material" rid="S1" href="#S1">S3</a>), and a multivariate diffusion model of evolution. We used three different measures: current temperature, the estimated LGM temperature, and the difference between the two (“range”) (see below). Analyses were run for 60 million generations, with a conservative burn-in of 10 millions. In all Bayesian analyses convergence was assessed with the effective sample size in TRACER 1.5. This reconstruction can be interpreted as the minimum amount of change in the thermal niche that the species should have experienced through their evolutionary history given the observed differences between species and the reconstructed topology.
  </p>
 </sec>
 <sec disp-level="3" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Estimating rates of thermal niche change</div>
  <p xmlns="http://www.w3.org/1999/xhtml">To estimate the minimum rates of thermal niche change that the species must have experienced we used three measures: i) average rate of thermal niche change, calculated as the average rate of all branches connecting all the specimens of each species with the root of the tree. For each branch, rate evolution was calculated as the absolute difference between the reconstructed initial and final temperatures divided by the length of the branch. ii) Maximum per-branch rate of thermal niche change, or the highest per-branch reconstructed rate among all the branches of the tree. iii) Adjusted LGM rate of change, calculated as the difference between the estimated paleotemperatures of the areas occupied by the species during the LGM (21,000 YBP) and the current temperatures. This range was estimated according to our conclusion that the species experienced this variation 
   <span class="italic">in situ</span> (see Results above) (
   <a ref-type="fig" rid="f1" href="#f1">Figs 1b</a> and 
   <a ref-type="fig" rid="f2" href="#f2">2b,f</a>).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">We also estimated how many of the current localities in which each species occur would have suitable thermal conditions in 2080 (see 
   <a ref-type="fig" rid="f2" href="#f2">Fig. 2d,h</a>), following the same procedure as before but projecting the thermal niche of each species to the predicted temperature for 2080 according to the B2 and A2 scenarios for the CCCMA-CGCM2 climate model through the CIAT database (
   <span ext-link-type="uri" xlink:href="http://www.ccafs-climate.org" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">www.ccafs-climate.org</span>), and at the same spatial resolution.
  </p>
 </sec>
</sec>
